<%- include('partials/head') %>
<style>
  a {
    color: white;
    text-decoration: none;
  }
</style>
</head>

<body>
  <%- include('partials/navbar') %>

  <div class="container mt-4">

    <% if (!currentUser) { %>
    <!-- Guest -->
    <h3>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h3>
    <a href="/login" class="btn btn-primary mt-3">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</a>

    <% } else { %>
    <h2>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
    <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> <%= currentUser.name %></p>
    <p><strong>‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</strong> <%= currentUser.email %></p>
    <a href="/profile/edit" class="btn btn-primary mb-3">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
    <hr>

    <h4>üéüÔ∏è ‡∏ö‡∏±‡∏ï‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h4>

    <% if (!tickets || tickets.length===0) { %>
    <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ï‡∏±‡πã‡∏ß</p>
    <% } else { %>
    <div class="row">
      <% tickets.forEach(t => { %>
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title"><%= t.event ? t.event.title : '(‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå‡∏ñ‡∏π‡∏Å‡∏•‡∏ö)' %></h5>
            <p class="mb-1"><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</strong> <%= t.quantity %> ‡πÉ‡∏ö</p>
            <p class="mb-1"><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠:</strong> <%= t.purchasedAt ? t.purchasedAt.toLocaleString() : '-' %></p>

            <% if (t.event && t.event.startDate) { %>
            <p class="mb-1"><strong>‡πÄ‡∏£‡∏¥‡πà‡∏°:</strong> <%= t.event.startDate.toLocaleString() %></p>
            <% } %>

            <% if (t.qrCodeData) { %>
            <div class="text-center mt-3">
              <img src="<%= t.qrCodeData %>" alt="QR Code" style="width:130px; height:130px;">
              <p class="text-muted mt-2"><small>ID: <%= t.qrCodeId %></small></p>
              <% if (t.checkedIn) { %>
              <span class="badge bg-success">‚úÖ ‡πÄ‡∏ä‡πá‡∏Å‡∏≠‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>
              <% } else { %>
              <span class="badge bg-warning text-dark">‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Å‡∏≠‡∏¥‡∏ô</span>
              <% } %>
            </div>
            <% } else { %>
            <div class="alert alert-secondary mt-2">‡πÑ‡∏°‡πà‡∏°‡∏µ QR Code</div>
            <% } %>

          </div>
        </div>
      </div>
      <% }) %>
    </div>
    <% } %>
    <% } %>


  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>