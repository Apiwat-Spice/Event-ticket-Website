<%- include('../partials/head') %>

</head>

<body>
  <%- include('../partials/navbar') %>
  <div class="container mt-4">
    <h2>เช็กอินตั๋วด้วย QR Code / Ticket ID</h2>

    <form id="checkinForm">
      <div class="mb-3">
        <label for="qrCodeId" class="form-label">วาง URL หรือ QR Ticket ID</label>
        <input type="text" class="form-control" id="qrCodeId" placeholder="ใส่ QR URL หรือ Ticket ID" required>
      </div>
      <button type="submit" class="btn btn-primary">เช็กอิน</button>
    </form>

    <div id="result" class="mt-3"></div>
  </div>

  <script>
    document.getElementById('checkinForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      let input = document.getElementById('qrCodeId').value.trim();

      // ถ้าเป็น URL ให้เอา ticketId (ส่วนท้าย)
      if (input.startsWith('http')) {
        const parts = input.split('/');
        input = parts[parts.length - 1];
      }

      const res = await fetch(`/organizer/api/checkin/${input}`);
      const data = await res.json();

      const resultDiv = document.getElementById('result');
      if (data.success) {
        resultDiv.innerHTML = `<div class="alert alert-success">${data.message} ของ ${data.buyer} รหัส QrCode คือ  ${data.idticket} </div>`;
      } else {
        resultDiv.innerHTML = `<div class="alert alert-danger">${data.message} รหัส QrCode คือ ${data.idticket}</div>`;
      }
    });
  </script>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>