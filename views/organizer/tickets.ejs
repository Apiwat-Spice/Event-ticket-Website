<%- include('../partials/head') %>
</head>

<body>
  <%- include('../partials/navbar') %>
  <div class="container">

    <h2>รายชื่อผู้ซื้อตั๋ว - <%= event.title %></h2>
    <p><strong>วันที่เริ่ม:</strong> <%= event.startDate ? event.startDate.toLocaleString() : '-' %></p>
    <p><strong>สถานที่:</strong> <%= event.location || '-' %></p>

    <a href="/organizer/dashboard" class="btn btn-secondary mb-3">⬅ กลับ</a>

    <% if (tickets.length === 0) { %>
    <div class="alert alert-warning">ยังไม่มีผู้ซื้อตั๋วสำหรับอีเวนต์นี้</div>
    <% } else { %>
    <table class="table table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>ชื่อผู้ซื้อ</th>
          <th>อีเมล</th>
          <th>จำนวน</th>
          <th>ราคารวม</th>
          <th>วันที่ซื้อ</th>
          <th>QR Code</th>
          <th>สถานะ</th>
        </tr>
      </thead>
      <tbody>
        <% tickets.forEach((t, i) => { %>
        <tr>
          <td><%= i + 1 %></td>
          <td><%= t.buyer ? t.buyer.name : '(ผู้ใช้ถูกลบ)' %></td>
          <td><%= t.buyer ? t.buyer.email : '-' %></td>
          <td><%= t.quantity %></td>
          <td><%= event.price*t.quantity %></td>
          <td><%= t.purchasedAt.toLocaleString() %></td>
          <td>
            <% if (t.qrCodeData) { %>
            <img src="<%= t.qrCodeData %>" alt="QR" style="width:60px; height:60px;">
            <% } else { %>
            -
            <% } %>
          </td>
          <td>
            <% if (t.checkedIn) { %>
            <span class="badge bg-success">✅ เช็กอินแล้ว</span>
            <% } else { %>
            <span class="badge bg-warning text-dark">⏳ ยังไม่เช็กอิน</span>
            <% } %>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
    <% } %>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>